SYSTEM_PROMPT = (
    "–¢—ã ‚Äî –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –º–µ–Ω—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –¥–∞—ë—Ç –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Ä–∞–∑–Ω—É—é —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å —Å—Ç–∞–∂—ë—Ä—É –ø–æ –µ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º —Ä–∞–±–æ—Ç—ã. "
    "–û–±—ä—è—Å–Ω–∏, –ø–æ—á–µ–º—É –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ AHT, –î–£ –∏ Transfer –¥–æ–ª–∂–Ω—ã —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è –∫ 100%, –∞ –ù–∞–≤–∏–≥–∞—Ü–∏—è ‚Äî –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 45%, "
    "–ø–æ—è—Å–Ω–∏, —á—Ç–æ –∑–Ω–∞—á–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∏–∂–µ —ç—Ç–∏—Ö –ø–æ—Ä–æ–≥–æ–≤ –∏ –∫–∞–∫–∏–µ —ç—Ç–æ –Ω–µ—Å—ë—Ç –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è. "
    "–ò—Å–ø–æ–ª—å–∑—É–π —Ç–µ—Ö–Ω–∏–∫—É ¬´–±—É—Ç–µ—Ä–±—Ä–æ–¥¬ª: –Ω–∞—á–Ω–∏ —Å –ø–æ—Ö–≤–∞–ª—ã, –∑–∞—Ç–µ–º –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —É–∫–∞–∂–∏ –Ω–∞ –∑–æ–Ω—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏, "
    "–∏ –∑–∞–≤–µ—Ä—à–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏ –º–æ—Ç–∏–≤–∞—Ü–∏–µ–π, —á—Ç–æ–±—ã —Å—Ç–∞–∂—ë—Ä –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –¥–ª—è —Ä–æ—Å—Ç–∞. "
    "–û–±—Ä–∞—â–∞–π—Å—è –ø–æ –∏–º–µ–Ω–∏, –∏—Å–ø–æ–ª—å–∑—É–π –∂–∏–≤–æ–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –∏—Å–∫—Ä–µ–Ω–Ω–∏–π —Ç–æ–Ω. "
    "–ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:\n"
    "- –ï—Å–ª–∏ AHT –Ω–∏–∂–µ 100%, –ø–æ—Å–æ–≤–µ—Ç—É–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä—É—Ç–∏–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Å –ø–æ–º–æ—â—å—é IVR –∏–ª–∏ —á–∞—Ç-–±–æ—Ç–æ–≤, –∞ —Ç–∞–∫–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.\n"
    "- –ï—Å–ª–∏ –î–£ –Ω–∏–∂–µ 100%, –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥—É–π –∞–∫—Ç–∏–≤–Ω–æ —Å–ª—É—à–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞, –∑–∞–¥–∞–≤–∞—Ç—å —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–æ—è–≤–ª—è—Ç—å —ç–º–ø–∞—Ç–∏—é –∏ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã.\n"
    "- –ï—Å–ª–∏ –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∏–∂–µ 45%, –ø–æ–¥—á–µ—Ä–∫–Ω–∏, —á—Ç–æ —ç—Ç–æ –∑–æ–Ω–∞ —Ä–æ—Å—Ç–∞ –∏ –≤–∞–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ñ—Ä–∞–∑–æ–π –¥–ª—è –ø—Ä–æ—Å—å–±—ã –æ—Ü–µ–Ω–∫–∏, –±–æ–ª—å—à–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å.\n"
    "- –ï—Å–ª–∏ Transfer –Ω–∏–∂–µ 100%, –ø–æ—Å–æ–≤–µ—Ç—É–π –∏–∑–±–µ–≥–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∏ –≤—Å–µ–≥–¥–∞ —É—Ç–æ—á–Ω—è—Ç—å —É –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ, –µ—Å–ª–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∏–∂–µ 70%.\n"
    "–î–µ–ª–∞–π —Ç–µ–∫—Å—Ç –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–º –∏ –æ—á–µ–Ω—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º, —á—Ç–æ–±—ã —Å—Ç–∞–∂—ë—Ä –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª –∑–∞–±–æ—Ç—É –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É."
)


def create_friendly_feedback(name: str, metrics: dict, comment: str = "") -> str:
    def safe_int(val):
        try:
            return int(val.replace("%", "").strip())
        except Exception:
            return 0
    
    aht = safe_int(metrics.get("AHT", "0"))
    du = safe_int(metrics.get("–î–£", "0"))
    transfer = safe_int(metrics.get("Transfer", "0"))
    navigation = safe_int(metrics.get("–ù–∞–≤–∏–≥–∞—Ü–∏—è", "0"))
    
    feedback = f"–ü—Ä–∏–≤–µ—Ç, {name}! üëã\n\n–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –≤–∫–ª–∞–¥—ã–≤–∞–µ—à—å—Å—è –∏ —Å—Ç–∞—Ä–∞–µ—à—å—Å—è ‚Äî —ç—Ç–æ –æ—á–µ–Ω—å —Ü–µ–Ω–Ω–æ! –î–∞–≤–∞–π –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Ç–≤–æ–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –≤–º–µ—Å—Ç–µ:\n\n"
    
    TARGETS = {
        "AHT": {
            "goal": 100, "min": 98,
            "advice": [
                "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ IVR –∏ —á–∞—Ç-–±–æ—Ç—ã.",
                "–ò—Å–ø–æ–ª—å–∑—É–π –í–¢–ë –û–Ω–ª–∞–π–Ω –¥–ª—è —Å–∞–º–æ–ø–æ–º–æ—â–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤.",
                "–ì–æ—Ç–æ–≤—å —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤."
            ],
            "phrases": [
                '"–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç–µ—Ä–ø–µ–ª–∏–≤–æ –æ–∂–∏–¥–∞–µ—Ç–µ, —è —Å–µ–π—á–∞—Å –±—ã—Å—Ç—Ä–æ –ø–æ–º–æ–≥—É –≤–∞–º."',
                '"–î–∞–≤–∞–π—Ç–µ —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å —Ä–µ—à–∏—Ç—å –≤–∞—à –≤–æ–ø—Ä–æ—Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ."'
            ],
            "note": "–î–ª—è —É–ª—É—á—à–µ–Ω–∏—è AHT –∏—Å–ø–æ–ª—å–∑—É–π –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã:"
        },
        "–î–£": {
            "goal": 100, "min": 98,
            "advice": [
                "–ê–∫—Ç–∏–≤–Ω–æ —Å–ª—É—à–∞–π –∏ —É—Ç–æ—á–Ω—è–π –¥–µ—Ç–∞–ª–∏.",
                "–ë—É–¥—å –¥–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ–π, –ø—Ä–æ—è–≤–ª—è–π —ç–º–ø–∞—Ç–∏—é.",
                "–ü—Ä–µ–¥–ª–∞–≥–∞–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è."
            ],
            "phrases": [
                '"–ú–Ω–µ –æ—á–µ–Ω—å –∂–∞–ª—å, —á—Ç–æ –≤—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –¥–∞–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–µ–π."',
                '"–ü–æ–Ω–∏–º–∞—é, —Å–∏—Ç—É–∞—Ü–∏—è –Ω–µ–ø—Ä–∏—è—Ç–Ω–∞—è."',
                '"–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –ø–æ–¥–µ–ª–∏–ª–∏—Å—å, —è —Å–¥–µ–ª–∞—é –≤—Å—ë –≤–æ–∑–º–æ–∂–Ω–æ–µ, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å."',
                '"–î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –Ω–∞–∏–ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –≤–∞—Å."'
            ],
            "note": "–î–ª—è —É–ª—É—á—à–µ–Ω–∏—è –î–£ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—Ä–∞–∑—ã –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (–ò–ö–°):"
        },
        "Transfer": {
            "goal": 100, "min": 98,
            "advice": [
                "–ò–∑–±–µ–≥–∞–π –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤.",
                "–£—Ç–æ—á–Ω—è–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–¥–∞ —É –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞."
            ],
            "phrases": [
                '"–î–∞–≤–∞–π—Ç–µ —É—Ç–æ—á–Ω–∏–º, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É."',
                '"–Ø —Å–µ–π—á–∞—Å –ø–µ—Ä–µ–≤–µ–¥—É –≤–∞—à –∑–∞–ø—Ä–æ—Å –∫–æ–ª–ª–µ–≥–µ, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç–æ—á–Ω–æ."'
            ],
            "note": "–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π —Ç–∞–∫–∏–µ —Ñ—Ä–∞–∑—ã:"
        },
        "–ù–∞–≤–∏–≥–∞—Ü–∏—è": {
            "goal": 45, "min": 40,
            "advice": [
                "–ò—Å–ø–æ–ª—å–∑—É–π —Ñ—Ä–∞–∑—ã: ¬´–ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –Ω–∞—Å, –æ—Ü–µ–Ω–∏–≤ –Ω–∞—à—É —Ä–∞–±–æ—Ç—É. –≠—Ç–æ –≤–∞–∂–Ω–æ!¬ª",
                "¬´–£–¥–µ–ª–∏—Ç–µ –º–∏–Ω—É—Ç—É –∏ —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –∫–∞–∫ –º—ã —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å.¬ª"
            ],
            "phrases": [
                '"–ë—É–¥—É –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω(–Ω–∞), –µ—Å–ª–∏ –≤—ã –æ—Å—Ç–∞–≤–∏—Ç–µ –æ—Ç–∑—ã–≤ –æ –Ω–∞—à–µ–º —Ä–∞–∑–≥–æ–≤–æ—Ä–µ."',
                '"–í–∞—à –æ—Ç–∑—ã–≤ –æ—á–µ–Ω—å –≤–∞–∂–µ–Ω –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è."'
            ],
            "note": "–î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø—Ä–æ—Å–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É —Ç–∞–∫–∏–º–∏ —Ñ—Ä–∞–∑–∞–º–∏:"
        }
    }
    
    # –û–±—â–∏–µ –ª–∞–π—Ñ—Ö–∞–∫–∏ –ø–æ –æ–±—â–µ–Ω–∏—é —Å –∫–ª–∏–µ–Ω—Ç–æ–º
    GENERAL_TIPS = [
        "–°–æ—Ö—Ä–∞–Ω—è–π —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏ –¥—Ä—É–∂–µ–ª—é–±–∏–µ, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª–µ–Ω.",
        "–ò–∑–±–µ–≥–∞–π –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å—Å—è –∫–∞–∫ –≥—Ä—É–±–æ—Å—Ç—å –∏–ª–∏ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç–∏.",
        "–°—Ç–∞—Ä–∞–π—Å—è –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∫–ª–∏–µ–Ω—Ç–∞, —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ.",
        "–ò—Å–ø–æ–ª—å–∑—É–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞ –∫–ª–∏–µ–Ω—Ç–∞, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å"
    ]
    
    def metric_block(name_metric, value):
        target = TARGETS[name_metric]
        goal = target["goal"]
        min_acceptable = target["min"]
        advice = target["advice"]
        
        block = ""
        if value >= goal:
            block += f"‚úÖ {name_metric} ‚Äî {value}% ‚Äî –æ—Ç–ª–∏—á–Ω–æ! –¢—ã –¥–æ—Å—Ç–∏–≥ —Ü–µ–ª–∏: {goal}% –∏ –≤—ã—à–µ.\n\n"
        elif value >= min_acceptable:
            block += (
                f"‚ö†Ô∏è {name_metric} ‚Äî {value}% ‚Äî –ø–æ—á—Ç–∏ —Ü–µ–ª—å ({goal}%), –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å.\n"
                f"–¶–µ–ª–µ–≤–æ–π –º–∏–Ω–∏–º—É–º: {min_acceptable}%.\n"
                "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:\n"
            )
            for tip in advice:
                block += f"‚Ä¢ {tip}\n"
            block += "\n"
        else:
            block += (
                f"‚ùóÔ∏è {name_metric} ‚Äî {value}% ‚Äî –Ω–∏–∂–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ —É—Ä–æ–≤–Ω—è ({min_acceptable}%).\n"
                "–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Ä–∞–±–æ—Ç–∞–π –Ω–∞–¥ —É–ª—É—á—à–µ–Ω–∏–µ–º:\n"
            )
            for tip in advice:
                block += f"‚Ä¢ {tip}\n"
            block += "\n"
            
            # –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑—ã, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –î–£)
            if "phrases" in target and "note" in target:
                block += f"{target['note']}\n"
                for phrase in target["phrases"]:
                    block += f"  ‚Äì {phrase}\n"
                block += "\n"
        return block
    
    feedback += metric_block("AHT", aht)
    feedback += metric_block("–î–£", du)
    feedback += metric_block("Transfer", transfer)
    feedback += metric_block("–ù–∞–≤–∏–≥–∞—Ü–∏—è", navigation)
    
    if comment:
        feedback += "üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –æ—Ç –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞:\n"
        feedback += f"‚Äî {comment.strip()}\n\n"
    
    feedback += "üí° –û–±—â–∏–µ —Å–æ–≤–µ—Ç—ã –ø–æ –æ–±—â–µ–Ω–∏—é —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏:\n"
    for tip in GENERAL_TIPS:
        feedback += f"‚Ä¢ {tip}\n"
    feedback += "\n"
    
    feedback += "–¢—ã –Ω–∞ –≤–µ—Ä–Ω–æ–º –ø—É—Ç–∏, –∏ —è –∏—Å–∫—Ä–µ–Ω–Ω–µ –≤–µ—Ä—é –≤ —Ç–≤–æ–π —Ä–æ—Å—Ç –∏ —É—Å–ø–µ—Ö! –ö–∞–∂–¥—ã–π —à–∞–≥ ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–µ—Å—Å, –∏ —è —Ä—è–¥–æ–º, —á—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ç–µ–±—è. –í–ø–µ—Ä—ë–¥ –∫ –Ω–æ–≤—ã–º –≤–µ—Ä—à–∏–Ω–∞–º! üöÄ"
    
    return feedback
